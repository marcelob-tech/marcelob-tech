name: ðŸ’¾ Smart Commit Schedule

on:
  schedule:
    - cron: "0 12 * * *" # roda todo dia Ã s 12h UTC (~09h BrasÃ­lia)
  workflow_dispatch: # permite rodar manualmente

permissions:
  contents: write

jobs:
  auto-commit:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ§© Checkout
        uses: actions/checkout@v4

      - name: ðŸ¤– Verificar se deve rodar hoje
        id: schedule
        run: |
          # Define o padrÃ£o de 8 dias: 2 sim, 1 nÃ£o, 3 sim, 1 nÃ£o, 2 sim, 1 nÃ£o
          pattern=(1 1 0 1 1 1 0 1 1 0) # 0 = pula, 1 = executa
          today=$(($(date +%j) % ${#pattern[@]}))
          should_run=${pattern[$today]}
          echo "today_index=$today"
          echo "should_run=$should_run" >> $GITHUB_ENV
          if [ "$should_run" -eq 0 ]; then
            echo "ðŸŸ¡ Dia de descanso, sem commit hoje."
            exit 0
          fi

      - name: ðŸ§  Gerar commit com emoji do dia
        if: env.should_run == '1'
        run: |
          case $(date +%u) in
            1) emoji="ðŸ’» Segunda de foco!";;
            2) emoji="âš™ï¸ TerÃ§a produtiva!";;
            3) emoji="â˜• Quarta de cÃ³digo!";;
            4) emoji="ðŸ”¥ Quinta intensa!";;
            5) emoji="ðŸš€ Sextou com commits!";;
            6) emoji="ðŸ˜Ž SÃ¡bado leve, mas com cÃ³digo!";;
            7) emoji="ðŸŒ´ Domingo relaxando e versionando!";;
          esac

          echo "update $(date)" >> log.txt
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add log.txt
          git commit -m "$emoji ($(date '+%d/%m/%Y %H:%M'))" || echo "Nada para commitar"
          git push
